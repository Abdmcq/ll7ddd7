<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© Ù‚Ø³Ù… Ø§Ù„ØªØ®Ø¯ÙŠØ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .dark .glass-card { background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(51, 65, 85, 0.8); }
        .admin-section { display: none; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen transition-colors">

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <header class="bg-white dark:bg-slate-900 shadow-sm sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-blue-600 rounded-lg text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.642.321a6 6 0 01-3.86.517l-2.388-.477a2 2 0 00-1.022.547l-1.168 1.168a2 2 0 00-.586 1.414l.018 4.342a2 2 0 002 1.996h13.011a2 2 0 002-1.996l.018-4.342a2 2 0 00-.586-1.414l-1.168-1.168z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 8a4 4 0 118 0 4 4 0 01-8 0z" />
                    </svg>
                </div>
                <h1 class="text-xl font-bold">Ù‚Ø³Ù… Ø§Ù„ØªØ®Ø¯ÙŠØ±</h1>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="promptAdmin()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full text-slate-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" /></svg>
                </button>
                <button onclick="toggleDarkMode()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full text-slate-500">
                    <svg id="theme-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                </button>
            </div>
        </div>
        <!-- Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div class="flex justify-center border-t border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900">
            <button onclick="switchTab('subs')" id="tab-subs" class="px-6 py-3 font-semibold transition-all tab-active">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</button>
            <button onclick="switchTab('projects')" id="tab-projects" class="px-6 py-3 font-semibold transition-all text-slate-500">Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø©</button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        
        <!-- Ù‚Ø³Ù… Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª -->
        <section id="section-subs" class="space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">Ø³Ø¬Ù„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>
                <button onclick="openModal('sub')" class="admin-section bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20">
                    + Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="subs-list">
                <!-- Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ù… Ù‡Ù†Ø§ -->
                <div class="p-10 text-center col-span-full text-slate-400">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            </div>
        </section>

        <!-- Ù‚Ø³Ù… Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø© -->
        <section id="section-projects" class="hidden space-y-6">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold">Ù…Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h2>
                <button onclick="openModal('project')" class="admin-section bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-xl text-sm font-bold shadow-lg shadow-blue-500/20">
                    + Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-list">
                <!-- Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ù‡Ù†Ø§ -->
            </div>
        </section>
    </main>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ -->
    <div id="modal-sub" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-900 w-full max-w-lg rounded-3xl p-8 shadow-2xl overflow-y-auto max-h-[90vh]">
            <h3 class="text-xl font-bold mb-6">Ø¥Ø¶Ø§ÙØ© Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯</h3>
            <form id="form-sub" class="space-y-4">
                <input type="text" id="sub-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="sub-dept" placeholder="Ø§Ù„Ù‚Ø³Ù…" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <input type="tel" id="sub-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <div class="space-y-2">
                    <label class="text-sm font-bold px-1">Ø£ÙŠØ§Ù… Ø§Ù„Ø¯ÙˆØ§Ù… ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:</label>
                    <div class="grid grid-cols-4 gap-2">
                        <label class="flex items-center gap-1 text-xs"><input type="checkbox" name="days" value="Ø£Ø­Ø¯"> Ø£Ø­Ø¯</label>
                        <label class="flex items-center gap-1 text-xs"><input type="checkbox" name="days" value="Ø§Ø«Ù†ÙŠÙ†"> Ø§Ø«Ù†ÙŠÙ†</label>
                        <label class="flex items-center gap-1 text-xs"><input type="checkbox" name="days" value="Ø«Ù„Ø§Ø«Ø§Ø¡"> Ø«Ù„Ø§Ø«Ø§Ø¡</label>
                        <label class="flex items-center gap-1 text-xs"><input type="checkbox" name="days" value="Ø£Ø±Ø¨Ø¹Ø§Ø¡"> Ø£Ø±Ø¨Ø¹Ø§Ø¡</label>
                        <label class="flex items-center gap-1 text-xs"><input type="checkbox" name="days" value="Ø®Ù…ÙŠØ³"> Ø®Ù…ÙŠØ³</label>
                    </div>
                </div>
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold">Ø­ÙØ¸</button>
                    <button type="button" onclick="closeModal('sub')" class="px-6 py-4 rounded-xl bg-slate-100 dark:bg-slate-800 font-bold text-slate-500">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ -->
    <div id="modal-project" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
        <div class="bg-white dark:bg-slate-900 w-full max-w-lg rounded-3xl p-8 shadow-2xl">
            <h3 class="text-xl font-bold mb-6">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹ Ø·Ù„Ø§Ø¨ÙŠ</h3>
            <form id="form-project" class="space-y-4">
                <input type="text" id="p-img" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (URL)" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <input type="text" id="p-title" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <textarea id="p-desc" placeholder="Ù†Ø¨Ø°Ø© Ø¹Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" rows="3" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                <input type="text" id="p-contacts" placeholder="Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„" required class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-800 bg-transparent outline-none focus:ring-2 focus:ring-blue-500">
                <div class="flex gap-2 pt-4">
                    <button type="submit" class="flex-1 bg-blue-600 text-white py-4 rounded-xl font-bold">Ù†Ø´Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</button>
                    <button type="button" onclick="closeModal('project')" class="px-6 py-4 rounded-xl bg-slate-100 dark:bg-slate-800 font-bold text-slate-500">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ---
        const firebaseConfig = {
            apiKey: "AIzaSyAhZxGAYQi2zhYwLlgfv2EWHUvCcxCf43I",
            authDomain: "mychat-76a2b.firebaseapp.com",
            databaseURL: "https://mychat-76a2b-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "mychat-76a2b"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const ADMIN_PIN = "2025";
        let isAdmin = false;

        // --- ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ---
        function switchTab(tab) {
            document.getElementById('section-subs').classList.toggle('hidden', tab !== 'subs');
            document.getElementById('section-projects').classList.toggle('hidden', tab !== 'projects');
            document.getElementById('tab-subs').className = `px-6 py-3 font-semibold transition-all ${tab === 'subs' ? 'tab-active' : 'text-slate-500'}`;
            document.getElementById('tab-projects').className = `px-6 py-3 font-semibold transition-all ${tab === 'projects' ? 'tab-active' : 'text-slate-500'}`;
        }

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
        function promptAdmin() {
            const pin = prompt("Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:");
            if (pin === ADMIN_PIN) {
                isAdmin = true;
                document.querySelectorAll('.admin-section').forEach(el => el.style.display = 'block');
                alert("ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© âœ…");
                loadData(); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„ØªØ¸Ù‡Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù
            } else if (pin !== null) {
                alert("Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!");
            }
        }

        // --- ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ Modals ---
        function openModal(id) { document.getElementById(`modal-${id}`).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(`modal-${id}`).classList.add('hidden'); }

        // --- Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª) ---
        document.getElementById('form-sub').addEventListener('submit', (e) => {
            e.preventDefault();
            const days = Array.from(document.querySelectorAll('input[name="days"]:checked')).map(cb => cb.value);
            const data = {
                name: document.getElementById('sub-name').value,
                dept: document.getElementById('sub-dept').value,
                phone: document.getElementById('sub-phone').value,
                days: days,
                count: days.length,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            db.ref('subscriptions').push(data).then(() => {
                closeModal('sub');
                e.target.reset();
            });
        });

        // --- Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹) ---
        document.getElementById('form-project').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = {
                img: document.getElementById('p-img').value,
                title: document.getElementById('p-title').value,
                desc: document.getElementById('p-desc').value,
                contacts: document.getElementById('p-contacts').value,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            };
            db.ref('projects').push(data).then(() => {
                closeModal('project');
                e.target.reset();
            });
        });

        // --- ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        function loadData() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            db.ref('subscriptions').on('value', snap => {
                const list = document.getElementById('subs-list');
                list.innerHTML = "";
                snap.forEach(child => {
                    const d = child.val();
                    list.innerHTML += `
                        <div class="glass-card p-6 rounded-2xl relative">
                            ${isAdmin ? `<button onclick="deleteItem('subscriptions', '${child.key}')" class="absolute top-2 left-2 text-red-500 p-2">âœ•</button>` : ''}
                            <h4 class="font-bold text-lg text-blue-600">${d.name}</h4>
                            <p class="text-sm opacity-70 mb-2">${d.dept}</p>
                            <div class="space-y-1 text-sm border-t border-slate-200 dark:border-slate-800 pt-3">
                                <p>ğŸ“± <span class="font-mono">${d.phone}</span></p>
                                <p>ğŸ—“ï¸ Ø§Ù„Ø¯ÙˆØ§Ù…: <span class="font-bold">${d.count} Ø£ÙŠØ§Ù…</span></p>
                                <p class="text-blue-500 font-bold italic">${d.days.join(' - ')}</p>
                            </div>
                        </div>
                    `;
                });
                if (!snap.exists()) list.innerHTML = `<div class="col-span-full py-10 text-slate-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>`;
            });

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            db.ref('projects').on('value', snap => {
                const list = document.getElementById('projects-list');
                list.innerHTML = "";
                snap.forEach(child => {
                    const d = child.val();
                    list.innerHTML += `
                        <div class="glass-card rounded-2xl overflow-hidden group">
                            <div class="h-48 overflow-hidden relative">
                                <img src="${d.img}" alt="Project" class="w-full h-full object-cover transition-transform group-hover:scale-105" onerror="this.src='https://via.placeholder.com/400x300?text=Project+Image'">
                                ${isAdmin ? `<button onclick="deleteItem('projects', '${child.key}')" class="absolute top-2 left-2 bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center">âœ•</button>` : ''}
                            </div>
                            <div class="p-6">
                                <h4 class="font-bold text-xl mb-2">${d.title}</h4>
                                <p class="text-slate-500 dark:text-slate-400 text-sm mb-4 line-clamp-3">${d.desc}</p>
                                <div class="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl">
                                    <p class="text-xs font-bold text-blue-600 mb-1 italic">Ù„Ù„ØªÙˆØ§ØµÙ„:</p>
                                    <p class="text-sm font-bold">${d.contacts}</p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                if (!snap.exists()) list.innerHTML = `<div class="col-span-full py-10 text-slate-400 text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…Ø¶Ø§ÙØ© Ø¨Ø¹Ø¯</div>`;
            });
        }

        function deleteItem(path, key) {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) db.ref(`${path}/${key}`).remove();
        }

        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');
        loadData();
    </script>
</body>
</html>

